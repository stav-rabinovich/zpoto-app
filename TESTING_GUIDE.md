# 🧪 מדריך בדיקה מלא - מערכת זמינות חניות

מסמך זה מכיל הוראות בדיקה מפורטות לכל התכונות החדשות שפותחו במערכת. **אחרי ביצוע כל הבדיקות האלו נדע מה הבעיות ומה צריך לתקן.**

## 🎭 חלוקת תפקידים

- **ישראל** = בעל חניה 🏠 (משתמש עם חניות בבעלותו)  
- **סתיו** = מחפש חניה 🔍 (משתמש רגיל שמחפש חניה)

## ✅ תיקונים שבוצעו לאחרונה:

1. ✅ **מועדפים** - תוקן חישוב parkingId (המרה למספר)
2. ✅ **כפתור "חפש כאן"** - הפונקציות searchByViewport ו-searchHere תוקנו  
3. ✅ **כפתור "הצג במפה"** - תוקן טיפול ב-coordinates (lat/lng vs latitude/longitude)
4. ✅ **כפתור "הזמן עכשיו"** - תוקן useAuthGate עם attemptAction ו-ACTIONS_REQUIRING_AUTH

#### **שלב 1.1: הרשמה**
- [ ] פתח את האפליקציה
- [ ] לחץ על "הרשמה"
- [ ] הזן אימייל וסיסמה
- [ ] ודא שההרשמה מצליחה
- [ ] **בדיקה**: טוקן נשמר ב-Secure Storage (לא AsyncStorage)

#### **שלב 1.2: חיפוש חניה**
- [ ] במסך הבית, הזן חיפוש (למשל "תל אביב")
- [ ] ודא שהחיפוש נשמר בשרת
- [ ] חזור למסך הבית
- [ ] **בדיקה**: החיפוש מופיע ב"חיפושים אחרונים" מהשרת

#### **שלב 1.3: הזמנת חניה**
- [ ] בחר חניה מתוצאות החיפוש
- [ ] בחר זמן התחלה וסיום
- [ ] השלם הזמנה
- [ ] **בדיקה**: ההזמנה נשמרת בשרת ומופיעה ב"ההזמנות שלי"

---

### **✅ תרחיש 2: בעל חניה**
**זרימה**: בקשה → אישור → ניהול

#### **שלב 2.1: הגשת בקשה**
- [ ] לחץ על "הפוך לבעל חניה"
- [ ] מלא פרטים אישיים
- [ ] שלח בקשה
- [ ] **בדיקה**: סטטוס "ממתין לאישור" מהשרת

#### **שלב 2.2: אישור בקשה (דמה)**
- [ ] במסך DebugScreen או דרך מנהל
- [ ] אשר את הבקשה
- [ ] **בדיקה**: סטטוס משתנה ל"מאושר" בשרת

#### **שלב 2.3: ניהול חניות**
- [ ] גש למסך ניהול בעל חניה
- [ ] הוסף חניה חדשה
- [ ] ערוך פרטי חניה
- [ ] **בדיקה**: כל השינויים נשמרים בשרת

---

### **✅ תרחיש 3: מועדפים**
**זרימה**: הוספה → הסרה → סינכרון

#### **שלב 3.1: הוספת מועדף**
- [ ] בתוצאות חיפוש, לחץ על לב ליד חניה
- [ ] ודא שהלב מתמלא (אדום)
- [ ] **בדיקה**: המועדף נשמר בשרת

#### **שלב 3.2: צפייה במועדפים**
- [ ] עבור למסך "מועדפים"
- [ ] ודא שהחניה מופיעה
- [ ] **בדיקה**: הנתונים נטענים מהשרת

#### **שלב 3.3: הסרת מועדף**
- [ ] במסך מועדפים, הסר חניה
- [ ] חזור לתוצאות חיפוש
- [ ] **בדיקה**: הלב ריק (לא אדום)

---

### **✅ תרחיש 4: הזמנות פעילות**
**זרימה**: יצירה → הצגה → עדכון

#### **שלב 4.1: יצירת הזמנה פעילה**
- [ ] צור הזמנה שמתחילה עכשיו
- [ ] ודא שההזמנה מאושרת
- [ ] **בדיקה**: ההזמנה נשמרת בשרת

#### **שלב 4.2: הצגה במסך הבית**
- [ ] חזור למסך הבית
- [ ] ודא שמופיע באנר "חניה פעילה עכשיו"
- [ ] **בדיקה**: הנתונים נטענים מ-`/api/bookings/active`

#### **שלב 4.3: עדכון בזמן אמת**
- [ ] השאר את המסך פתוח
- [ ] ודא שהטיימר מתעדכן
- [ ] **בדיקה**: הזמן נותר מחושב מנתוני השרת

---

## 🔍 **בדיקות אבטחה**

### **בדיקה A: Validation**
```javascript
// בקונסול הדפדפן/מכשיר:
// נסה לשלוח נתונים לא תקינים
fetch('/api/favorites', {
  method: 'POST',
  body: JSON.stringify({ parkingId: "invalid" })
});
// צריך להחזיר שגיאה validation
```

### **בדיקה B: Error Boundaries**
```javascript
// גרום לשגיאה JavaScript במכוון
throw new Error("Test error");
// צריך להציג מסך שגיאה יפה, לא קריסה
```

### **בדיקה C: Loading States**
- [ ] בדוק שכל המסכים מציגים loading במהלך טעינה
- [ ] בדוק empty states כשאין נתונים
- [ ] בדוק error states כשיש שגיאת רשת

---

## 🚫 **בדיקות AsyncStorage (צריכות להיכשל)**

### **בדיקה נגטיבית 1: אין AsyncStorage**
```javascript
// בקונסול:
import AsyncStorage from '@react-native-async-storage/async-storage';
AsyncStorage.getItem('bookings');
// צריך להחזיר null או undefined - לא נתונים ישנים
```

### **בדיקה נגטיבית 2: אין keys ישנים**
```javascript
// בקונסול:
AsyncStorage.getAllKeys().then(keys => {
  const oldKeys = keys.filter(key => 
    ['bookings', 'favorites', 'profile', 'recentSearches'].includes(key)
  );
  console.log('Old keys found:', oldKeys);
  // צריך להיות array ריק []
});
```

---

## 📱 **בדיקות מכשירים**

### **iPhone**
- [ ] iOS Safari
- [ ] אפליקציה native (אם יש)
- [ ] בדיקת orientation (לרוחב/לאורך)

### **Android**
- [ ] Chrome Android
- [ ] אפליקציה native (אם יש)
- [ ] מכשירים שונים (גדול/קטן)

### **Desktop** (אם רלוונטי)
- [ ] Chrome Desktop
- [ ] Safari Desktop
- [ ] Firefox

---

## 🌐 **בדיקות רשת**

### **Offline/Online**
- [ ] התחל עם חיבור אינטרנט
- [ ] נתק אינטרנט
- [ ] **בדיקה**: האפליקציה מציגה שגיאות ברורות
- [ ] חבר אינטרנט חזרה
- [ ] **בדיקה**: הנתונים מתרעננים אוטומטית

### **רשת איטית**
- [ ] הדמה רשת איטית (Chrome DevTools)
- [ ] **בדיקה**: loading states מופיעים
- [ ] **בדיקה**: אין timeouts מהירים מדי

---

## ✅ **קריטריונים להצלחה**

### **חובה לעבור:**
1. ✅ אין שימוש ב-AsyncStorage למידע עסקי
2. ✅ כל הנתונים נטענים מהשרת
3. ✅ שגיאות מטופלות בצורה יפה
4. ✅ Loading states עובדים
5. ✅ הזרימות הבסיסיות עובדות

### **נחמד לעבור:**
1. 🎯 ביצועים טובים (טעינה מהירה)
2. 🎯 אנימציות חלקות
3. 🎯 UX מעולה
4. 🎯 תמיכה בoffline (הודעות ברורות)

---

## 🐛 **מה לעשות אם יש בעיה**

### **אם זרימה לא עובדת:**
1. בדוק את הקונסול לשגיאות
2. בדוק את Network tab בDevTools
3. ודא שה-API endpoints עובדים
4. בדוק שהטוקן תקין

### **אם יש AsyncStorage:**
1. מצא את הקובץ עם `grep -r "AsyncStorage"`
2. החלף ב-API call מתאים
3. הסר את ה-import
4. בדוק שהזרימה עובדת

### **אם יש שגיאות:**
1. הוסף try/catch מתאים
2. הצג הודעת שגיאה למשתמש
3. לוג את השגיאה לקונסול
4. הוסף fallback אם אפשר

---

**🎉 בהצלחה! אחרי שכל הבדיקות עוברות - המעבר לשרת הושלם בהצלחה!**
