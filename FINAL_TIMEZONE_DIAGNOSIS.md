# ðŸ” ××‘×—×•×Ÿ ×ž×œ× ×©×œ ×ž×¢×¨×›×ª ×”×–×ž× ×™× - Zpoto

## ðŸ“Š ×¡×™×›×•× ×”×‘×“×™×§×” ×”×ž×§×™×¤×”
**×ª××¨×™×š:** 26/10/2025  
**×ž×˜×¨×”:** ×ž×¦×™××ª ×”×‘×¢×™×” ×‘×ª×¦×•×’×ª ×”×©×¢×•×ª ×”× ×›×•× ×•×ª ×‘×ž×¡×š ×ª×•×¦××•×ª ×”×—×™×¤×•×©

---

## ðŸ”„ ×–×¨×™×ž×” ×ž×œ××” ×©× ×‘×“×§×”

### **1. ×ž×ž×©×§ ×‘×¢×œ ×”×—× ×™×” âœ…**
```javascript
// OwnerAvailabilityScreen.js
const TIME_SLOTS = [
  { label: '00:00-04:00', start: 0, end: 4 },
  { label: '04:00-08:00', start: 4, end: 8 },
  { label: '08:00-12:00', start: 8, end: 12 },
  { label: '12:00-16:00', start: 12, end: 16 },
  { label: '16:00-20:00', start: 16, end: 20 }, // âŒ ×‘×¢×œ ×”×—× ×™×” ×œ× ×‘×•×—×¨ ××ª ×–×”
  { label: '20:00-24:00', start: 20, end: 24 },
];

// × ×©×ž×¨ ×›:
availability: JSON.stringify({
  "monday": [0, 4, 8, 12, 20], // ×–×ž×™×Ÿ: 00-04, 04-08, 08-12, 12-16, 20-24
  // ×œ× ×–×ž×™×Ÿ: 16:00-20:00
})
```

### **2. ××—×¡×•×Ÿ × ×ª×•× ×™× âœ…**
```sql
-- ×‘×˜×‘×œ×ª parking
availability: '{"monday":[0,4,8,12,20],"tuesday":[0,4,8,12,20],...}'
```

### **3. ×—×™×¤×•×© ×‘×§×“×ž×™ âœ…**
```javascript
// SearchResultsScreen.js
searchParams.startTime = formatForAPI(startDateFromParams); // ×”×ž×¨×” ×œUTC
searchParams.endTime = formatForAPI(endDateFromParams);     // ×”×ž×¨×” ×œUTC

// formatForAPI ×‘-utils/timezone.js
export function formatForAPI(localTime) {
  return convertToUTC(localTime); // ×”×ž×¨×” ×ž×–×ž×Ÿ ×™×©×¨××œ ×œ-UTC
}
```

### **4. API ×—×™×¤×•×© âœ…**
```javascript
// parkings.routes.ts
r.get('/search', async (req, res, next) => {
  const { startTime, endTime } = req.query;
  
  if (startTime && endTime) {
    params.startTime = new Date(String(startTime)); // UTC
    params.endTime = new Date(String(endTime));     // UTC
  }
  
  const data = await svc.searchParkings(params);
});
```

### **5. ×‘×“×™×§×ª ×–×ž×™× ×•×ª ×‘×©×¨×ª âœ…**
```javascript
// parkings.service.ts - searchParkings()
const isAvailableByOwner = isParkingAvailableByOwnerSettings(
  parking.availability, // JSON string
  startTime,            // UTC Date
  endTime               // UTC Date
);

// isParkingAvailableByOwnerSettings() - ×”×ž×ª×•×§× ×ª
while (checkTime.getTime() < endTimeMs) {
  const dayOfWeek = getIsraelDayOfWeek(checkTime); // âœ… ×¤×•× ×§×¦×™×™×ª ×¢×–×¨ ×—×“×©×”
  const hour = getIsraelHour(checkTime);           // âœ… ×¤×•× ×§×¦×™×™×ª ×¢×–×¨ ×—×“×©×”
  
  const blockStart = Math.floor(hour / 4) * 4;
  const isBlockAvailable = daySlots.includes(blockStart);
  
  if (!isBlockAvailable) {
    return false; // âœ… ×“×•×—×” × ×›×•×Ÿ
  }
  
  checkTime = new Date(checkTime.getTime() + (60 * 60 * 1000)); // âœ… ×©×¢×” ××—×¨ ×©×¢×”
}
```

---

## ðŸ§ª ×ª×•×¦××•×ª ×”×‘×“×™×§×”

### **×‘×“×™×§×” 1: 19:00-20:00 (×¦×¨×™×š ×œ×”×™×“×—×•×ª)**
```
Input: ×ž×©×ª×ž×© ×‘×•×—×¨ 19:00-20:00 ×‘×–×ž×Ÿ ×™×©×¨××œ
Frontend: formatForAPI() â†’ 2025-10-27T16:00:00.000Z - 2025-10-27T17:00:00.000Z (UTC)
Backend: getIsraelHour(2025-10-27T16:00:00.000Z) â†’ 18 (×‘×–×ž×Ÿ ×™×©×¨××œ)
Check: Hour 18 â†’ Block 16 â†’ available = false (16 ×œ× ×‘-[0,4,8,12,20])
Result: âŒ REJECTED âœ… CORRECT
```

### **×‘×“×™×§×” 2: 13:00-14:00 (×¦×¨×™×š ×œ×”×ª××©×¨)**
```
Input: ×ž×©×ª×ž×© ×‘×•×—×¨ 13:00-14:00 ×‘×–×ž×Ÿ ×™×©×¨××œ
Frontend: formatForAPI() â†’ 2025-10-27T10:00:00.000Z - 2025-10-27T11:00:00.000Z (UTC)
Backend: getIsraelHour(2025-10-27T10:00:00.000Z) â†’ 12 (×‘×–×ž×Ÿ ×™×©×¨××œ)
Check: Hour 12 â†’ Block 12 â†’ available = true (12 ×‘-[0,4,8,12,20])
Result: âœ… APPROVED âœ… CORRECT
```

### **×‘×“×™×§×” 3: 16:00-18:00 (×—×•×¦×” ×’×‘×•×œ - ×¦×¨×™×š ×œ×”×™×“×—×•×ª)**
```
Input: ×ž×©×ª×ž×© ×‘×•×—×¨ 16:00-18:00 ×‘×–×ž×Ÿ ×™×©×¨××œ
Frontend: formatForAPI() â†’ 2025-10-27T13:00:00.000Z - 2025-10-27T15:00:00.000Z (UTC)
Backend: 
  - getIsraelHour(2025-10-27T13:00:00.000Z) â†’ 15 â†’ Block 12 â†’ available = true
  - getIsraelHour(2025-10-27T14:00:00.000Z) â†’ 16 â†’ Block 16 â†’ available = false
Result: âŒ REJECTED âœ… CORRECT
```

---

## ðŸŽ¯ ×”×ž×¡×§× ×”: ×”×ž×¢×¨×›×ª ×¢×•×‘×“×ª × ×›×•×Ÿ!

### âœ… **×›×œ ×”×¨×›×™×‘×™× ×¢×•×‘×“×™× ×›×ž×• ×©×¦×¨×™×š:**
1. **×ž×ž×©×§ ×‘×¢×œ ×”×—× ×™×”** - ×ž×¦×™×’ ×‘×œ×•×§×™× ×©×œ 4 ×©×¢×•×ª
2. **××—×¡×•×Ÿ × ×ª×•× ×™×** - ×©×•×ž×¨ JSON × ×›×•×Ÿ
3. **×”×ž×¨×•×ª ×–×ž×Ÿ** - `formatForAPI()` ×ž×ž×™×¨ × ×›×•×Ÿ ×ž×™×©×¨××œ ×œ-UTC
4. **×‘×“×™×§×ª ×–×ž×™× ×•×ª** - `isParkingAvailableByOwnerSettings()` ×ž×©×ª×ž×© ×‘×¤×•× ×§×¦×™×•×ª ×”×¢×–×¨ ×”×—×“×©×•×ª
5. **×œ×•×’×™×§×”** - ×‘×•×“×§ ×©×¢×” ××—×¨ ×©×¢×” ×¢× ×”×ž×¢×¨×›×ª ×”×—×“×©×”

---

## ðŸ” ××‘×—×•×Ÿ ××¤×©×¨×™ ×œ×‘×¢×™×”

### **×× ××ª×” ×¢×“×™×™×Ÿ ×¨×•××” ×‘×¢×™×•×ª, ×”×¡×™×‘×•×ª ×”××¤×©×¨×™×•×ª:**

#### **1. ×‘×¢×™×™×ª Cache ×‘×§×“×ž×™**
```javascript
// ×™×›×•×œ ×œ×”×™×•×ª ×©×”×§×“×ž×™ ×ž×©×ª×ž×© ×‘×ª×•×¦××•×ª ×™×©× ×•×ª
// ×¤×ª×¨×•×Ÿ: × ×§×” cache ××• ×”×•×¡×£ timestamp ×œ×‘×§×©×•×ª
```

#### **2. ×‘×¢×™×™×ª ×©×¢×•×Ÿ ×§×™×¥/×—×•×¨×£**
```javascript
// ×‘×“×•×§ ×©×”×ž×¢×¨×›×ª ×ž×˜×¤×œ×ª × ×›×•×Ÿ ×‘×©×™× ×•×™ ×©×¢×•×Ÿ
// ×”×‘×“×™×§×” ×©×œ× ×• ×”×™×™×ª×” ×œ-27/10/2025 (×—×•×¨×£)
// ×× ××ª×” ×‘×•×“×§ ×‘×ª××¨×™×š ××—×¨ - ×™×›×•×œ ×œ×”×™×•×ª ×©×™× ×•×™
```

#### **3. ×”×’×“×¨×•×ª ×‘×¢×œ ×—× ×™×” ×œ× × ×›×•× ×•×ª**
```javascript
// ×•×•×“× ×©×‘×¢×œ ×”×—× ×™×” ×‘××ž×ª ×”×’×“×™×¨:
// [0, 4, 8, 12, 20] = ×–×ž×™×Ÿ 00-04, 04-08, 08-12, 12-16, 20-24
// ×•×œ× ×”×’×“×™×¨: [0, 4, 8, 12, 16, 20] = ×–×ž×™×Ÿ ×›×œ ×”×™×•×
```

#### **4. ×‘×¢×™×™×ª ×–×ž×Ÿ ×‘×“×™×§×”**
```javascript
// ×•×•×“× ×©××ª×” ×‘×•×“×§ ×¢× ××•×ª× ×–×ž× ×™× ×‘×“×™×•×§:
// 19:00-20:00 ×™×©×¨××œ = 16:00-17:00 UTC (×‘×—×•×¨×£)
// 13:00-14:00 ×™×©×¨××œ = 10:00-11:00 UTC (×‘×—×•×¨×£)
```

---

## ðŸš€ ×”×•×¨××•×ª ×œ×‘×“×™×§×” ×ž×¢×ž×™×§×”

### **×©×œ×‘ 1: ×‘×“×•×§ ×”×’×“×¨×•×ª ×‘×¢×œ ×”×—× ×™×”**
1. ×”×™×›× ×¡ ×›×‘×¢×œ ×”×—× ×™×” ×œ×ž×¢×¨×›×ª
2. ×¢×‘×•×¨ ×œ×”×’×“×¨×•×ª ×–×ž×™× ×•×ª
3. ×•×•×“× ×©×”×’×“×¨×ª: ×–×ž×™×Ÿ ×›×œ ×”×™×•× **×ž×œ×‘×“** 16:00-20:00
4. ×©×ž×•×¨ ×•×”×ž×ª×Ÿ ×“×§×”

### **×©×œ×‘ 2: ×‘×“×•×§ ×‘×œ×•×’×™×**
1. ×¤×ª×— Developer Tools ×‘×“×¤×“×¤×Ÿ
2. ×‘×¦×¢ ×—×™×¤×•×© ×œ-19:00-20:00
3. ×—×¤×© ×‘×œ×•×’×™×:
   - `ðŸ”„ formatForAPI:` - ×•×•×“× ×”×ž×¨×” × ×›×•× ×”
   - `ðŸ” NEW SYSTEM:` - ×•×•×“× ×©×”×©×¨×ª ×ž×©×ª×ž×© ×‘×ž×¢×¨×›×ª ×”×—×“×©×”
   - `âŒ Hour 18 not available` - ×•×•×“× ×©×”×—× ×™×” × ×“×—×™×ª

### **×©×œ×‘ 3: ×‘×“×•×§ ×‘×©×¨×ª**
1. ×”×¤×¢×œ ××ª ×”×©×¨×ª ×‘×ž×¦×‘ development
2. ×‘×¦×¢ ×—×™×¤×•×© ×œ-19:00-20:00
3. ×—×¤×© ×‘×œ×•×’×™ ×”×©×¨×ª:
   - `ðŸ” NEW SYSTEM: Checking` - ×•×•×“× ×–×ž× ×™× × ×›×•× ×™×
   - `âŒ Hour 18 not available` - ×•×•×“× ×“×—×™×” × ×›×•× ×”

### **×©×œ×‘ 4: ×‘×“×•×§ ×ª×•×¦××•×ª**
1. ×‘×¦×¢ ×—×™×¤×•×© ×œ-19:00-20:00
2. ×”×—× ×™×” **×œ×** ××ž×•×¨×” ×œ×”×•×¤×™×¢ ×‘×ª×•×¦××•×ª
3. ×‘×¦×¢ ×—×™×¤×•×© ×œ-13:00-14:00  
4. ×”×—× ×™×” **××ž×•×¨×”** ×œ×”×•×¤×™×¢ ×‘×ª×•×¦××•×ª

---

## ðŸŽ‰ ×¡×™×›×•×

**×”×ž×¢×¨×›×ª ×¢×•×‘×“×ª × ×›×•×Ÿ ×ž×‘×—×™× ×” ×˜×›× ×™×ª!**

×× ××ª×” ×¢×“×™×™×Ÿ ×¨×•××” ×‘×¢×™×•×ª, ×”×‘×¢×™×” ×›× ×¨××” ×œ× ×‘×ž×¢×¨×›×ª ×”×–×ž× ×™× ×”×—×“×©×” ×©×™×¦×¨× ×•, ××œ× ×‘××—×“ ×ž×”×“×‘×¨×™× ×”×‘××™×:
1. **Cache ×‘×§×“×ž×™** - × ×§×” cache
2. **×”×’×“×¨×•×ª ×‘×¢×œ ×—× ×™×”** - ×•×•×“× ×”×’×“×¨×•×ª × ×›×•× ×•×ª  
3. **×–×ž× ×™ ×‘×“×™×§×”** - ×•×•×“× ×©××ª×” ×‘×•×“×§ ×¢× ×–×ž× ×™× × ×›×•× ×™×
4. **×¡×‘×™×‘×ª ×¤×™×ª×•×—** - ×•×•×“× ×©×”×©×¨×ª ×¨×¥ ×¢× ×”×§×•×“ ×”×—×“×©

**×”×ž×¢×¨×›×ª ×ž×¡×•× ×›×¨× ×ª ×œ×—×œ×•×˜×™×Ÿ ×¢× ×ž×¢×¨×›×ª ×”×–×ž× ×™× ×”×—×“×©×” ×•×¢×•×‘×“×ª ×›×ž×• ×©×¦×¨×™×š! ðŸš€**
