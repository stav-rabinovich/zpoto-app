# 🚪 תכנית עבודה: מערכת התנתקות וניהול משתמשים

## 🎯 **מטרה**
יישום מערכת התנתקות מלאה שמאפשרת למשתמש לחזור למצב משוטט, עם סטטיסטיקות אישיות לכל משתמש.

## 📋 **רשימת משימות**

---

## 🔐 **Phase 1: יישום כפתור התנתקות**

### Step 1.1: הוספת כפתור התנתקות לפרופיל
- [x] הוספת כפתור "התנתק" בתחתית ProfileScreen ✅
- [x] עיצוב הכפתור בצבע אדום עם איקון מתאים ✅
- [x] הוספת confirmation dialog "האם אתה בטוח?" ✅
- [x] חיבור הכפתור לפונקציית logout ✅

### Step 1.2: שיפור פונקציית logout ב-AuthContext
- [x] בדיקה ש-logout function קיימת ב-AuthContext ✅
- [x] וידוא שהפונקציה מנקה token מ-SecureStore ✅
- [x] וידוא שהפונקציה מנקה user מ-SecureStore ✅
- [x] וידוא שהפונקציה מאפסת state (setToken(null), setUser(null)) ✅
- [x] הוספת לוגים מפורטים לתהליך ההתנתקות ✅

### Step 1.3: ניקוי תוכן נוסף בהתנתקות
- [x] ניקוי NavigationContext (intended destinations) ✅
- [x] ניקוי cache של API calls אם קיים ✅
- [x] ניקוי מידע זמני נוסף ✅
- [x] וידוא שאחרי logout המשתמש חוזר לדף הבית ✅

---

## 📊 **Phase 2: תיקון סטטיסטיקות משתמש**

### Step 2.1: בדיקת סטטיסטיקות בפרופיל
- [x] זיהוי איפה נטענות הסטטיסטיקות בProfileScreen ✅
- [x] בדיקה ש-API call לסטטיסטיקות משתמש עובד נכון ✅
- [x] וידוא שכל משתמש רואה את הסטטיסטיקות שלו בלבד ✅
- [ ] בדיקה שאחרי התנתקות/התחברות הסטטיסטיקות מתעדכנות

### Step 2.2: תיקון API לסטטיסטיקות במידת הצורך
- [x] בדיקת endpoint /api/profile/stats בשרת ✅
- [x] וידוא שהשרת מחזיר סטטיסטיקות לפי המשתמש המחובר ✅
- [x] בדיקה שאין דליפת מידע בין משתמשים ✅
- [x] API עובד מושלם - אין צורך בתיקון ✅

---

## 🔄 **Phase 3: מעברים בין מצבים**

### Step 3.1: מצב משוטט אחרי התנתקות
- [ ] בדיקה שאחרי logout המשתמש חוזר למצב anonymous
- [ ] וידוא שמופיעים anonymous APIs בלוגים
- [ ] בדיקה שהדף הראשי עובד כמו למשתמש חדש
- [ ] וידוא שכפתורי AuthGate חוזרים לעבוד (מבקשים התחברות)

### Step 3.2: חזרה להתחברות
- [ ] בדיקה שאפשר להתחבר שוב אחרי logout
- [ ] בדיקה שההתחברות החדשה עובדת תקין
- [ ] וידוא שהמשתמש מקבל את הסטטיסטיקות הנכונות
- [ ] בדיקה שהגישה לפרופיל עובדת אחרי התחברות חוזרת

### Step 3.3: בדיקה עם משתמשים שונים
- [ ] יצירת משתמש שני לבדיקה (אם לא קיים)
- [ ] התחברות עם משתמש ראשון - בדיקת סטטיסטיקות
- [ ] התנתקות והתחברות עם משתמש שני
- [ ] וידוא שכל משתמש רואה סטטיסטיקות שונות

---

## 🧪 **Phase 4: בדיקות מקיפות**

### Step 4.1: בדיקת flow מלא
- [ ] משתמש משוטט → התחברות → צפייה בפרופיל → התנתקות → חזרה למצב משוטט
- [ ] בדיקה שכל הלוגים נראים נכון
- [ ] בדיקה שלא נשארים שאריות מהמשתמש הקודם
- [ ] בדיקה שהAuthGate עובד נכון בכל שלב

### Step 4.2: בדיקת edge cases
- [ ] התנתקות כפולה (לחיצה על logout פעמיים)
- [ ] התנתקות בזמן טעינת API
- [ ] התחברות מהירה אחרי התנתקות
- [ ] רענון דף אחרי התנתקות

### Step 4.3: ניקיון קוד ולוגים
- [ ] הסרת לוגים מיותרים שהוספנו לצורך debug
- [ ] וידוא שהקוד נקי וקריא
- [ ] הוספת הערות לפונקציות חשובות
- [ ] וידוא שאין warnings בקונסול

---

## ✅ **Phase 5: סיכום ותיעוד**

### Step 5.1: תיעוד המערכת
- [ ] תיעוד איך עובד תהליך ההתחברות/התנתקות
- [ ] תיעוד איך עובדות הסטטיסטיקות לכל משתמש
- [ ] תיעוד AuthGate ומעברים בין מצבים
- [ ] עדכון README הראשי עם המידע החדש

### Step 5.2: בדיקה אחרונה
- [ ] הרצה מלאה של כל התהליכים
- [ ] וידוא שהכל עובד במכשירים שונים
- [ ] בדיקת ביצועים וזמני טעינה
- [ ] סיום התכנית ומעבר לשלב הבא

---

## 🎯 **סיכום מטרות**

**לאחר השלמת התכנית:**
- ✅ כפתור התנתקות אדום בתחתית הפרופיל
- ✅ התנתקות מלאה עם ניקוי כל הנתונים
- ✅ חזרה למצב משוטט אחרי התנתקות
- ✅ סטטיסטיקות אישיות לכל משתמש
- ✅ מעברים חלקים בין מצבים
- ✅ AuthGate עובד נכון בכל המצבים

---

## 📝 **הערות יישום**

- **כפתור התנתקות**: בתחתית ProfileScreen, צבע אדום, עם אישור
- **ניקוי נתונים**: SecureStore, State, Navigation, Cache
- **מצב משוטט**: חזרה מלאה לmode אנונימי
- **סטטיסטיקות**: לכל משתמש בנפרד, ללא ערבוב נתונים
- **בדיקות**: flow מלא עם לוגים מפורטים
