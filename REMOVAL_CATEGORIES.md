# 🗂️ **תכנית הסרה מתואמת - Step 1.3**

## 📋 **חלוקה לקטגוריות לפי סוג נתונים**

---

## **🔐 קטגוריה 1: אימות (Authentication)**
### **מה מותר להישאר:**
- ✅ `userToken` ב-AuthContext.js
- ✅ `user` (פרטי משתמש בסיסיים) ב-AuthContext.js
- ✅ טעינת טוקן ב-utils/api.js

### **פעולות נדרשות:**
- 🔄 **שמירה על הקיים** - אלה הם השימושים היחידים המותרים

---

## **📅 קטגוריה 2: הזמנות (Bookings)**
### **קבצים מושפעים:**
- ❌ `BookingScreen.js` - שמירת הזמנות מקומיות כגיבוי
- ❌ `HomeScreen.js` - טעינת הזמנות פעילות מקומיות

### **שימושים לביטול:**
- `BOOKINGS_KEY` - שמירת הזמנות מקומיות
- `bookings` - טעינת הזמנות פעילות
- כל לוגיקת "שמירה מקומית אם השרת נכשל"

### **פעולות נדרשות:**
1. **הסרת שמירה מקומית** מ-BookingScreen
2. **מעבר מלא ל-API** `/api/bookings`
3. **החלפת fallback** במסך שגיאה
4. **הסרת טעינה מקומית** מ-HomeScreen

---

## **👤 קטגוריה 3: פרופיל ונתוני משתמש (Profile)**
### **קבצים מושפעים:**
- ❌ `ProfileScreen.js` - שמירת פרופיל מקומי
- ❌ `BookingScreen.js` - טעינת פרופיל מקומי

### **שימושים לביטול:**
- `PROFILE_KEY` - שמירת פרופיל מקומי
- שמירת אמצעי תשלום מקומיים

### **פעולות נדרשות:**
1. **מעבר מלא ל-API** `/api/profile`
2. **הסרת שמירה מקומית** של פרופיל
3. **יצירת API** לאמצעי תשלום (אם נדרש)

---

## **🚗 קטגוריה 4: רכבים (Vehicles)**
### **קבצים מושפעים:**
- ❌ `BookingScreen.js` - טעינת רכבים מקומיים
- ❌ `ProfileScreen.js` - ניהול רכבים (אם קיים)

### **שימושים לביטול:**
- `VEHICLES_KEY` - שמירת רכבים מקומיים
- `plate`, `carDesc` - שמירת פרטי רכב זמניים

### **פעולות נדרשות:**
1. **מעבר מלא ל-API** `/api/vehicles`
2. **הסרת שמירה מקומית** של רכבים
3. **הסרת שמירה זמנית** של פרטי רכב

---

## **🏢 קטגוריה 5: בעלי חניות (Owner Management)**
### **קבצים מושפעים:**
- ❌ `OwnerIntroScreen.js` - שמירת סטטוס בעלות
- ❌ `OwnerApplyScreen.js` - שמירת בקשות מקומיות
- ❌ `OwnerListingFormScreen.js` - שמירת טפסים
- ❌ `OwnerDashboardScreen.js` - שמירת נתוני דשבורד

### **שימושים לביטול:**
- שמירת סטטוס בקשות מקומיות
- שמירת טפסים בתהליך
- cache של נתוני דשבורד

### **פעולות נדרשות:**
1. **מעבר מלא ל-APIs** `/api/owner/*`
2. **הסרת שמירה מקומית** של סטטוסים
3. **הסרת cache מקומי** של נתונים

---

## **🔍 קטגוריה 6: חיפוש ומקומות (Search & Places)**
### **קבצים מושפעים:**
- ❌ `HomeScreen.js` - חיפושים אחרונים ומקומות שמורים
- ❌ `SearchResultsScreen.js` - cache תוצאות חיפוש
- ❌ `ProfileScreen.js` - מקומות שמורים

### **שימושים לביטול:**
- `RECENTS_KEY` - חיפושים אחרונים
- `SAVED_PLACES_KEY` - מקומות שמורים
- `lastQuery` - חיפוש אחרון
- cache תוצאות חיפוש

### **פעולות נדרשות:**
1. **יצירת APIs חדשים** למקומות שמורים וחיפושים
2. **מעבר מלא לשרת** לכל נתוני חיפוש
3. **הסרת cache מקומי** של תוצאות

---

## **⭐ קטגוריה 7: מועדפים (Favorites)**
### **קבצים מושפעים:**
- ❌ `FavoritesScreen.js` - שמירת מועדפים מקומיים

### **שימושים לביטול:**
- שמירת רשימת מועדפים מקומית
- cache מועדפים

### **פעולות נדרשות:**
1. **יצירת API חדש** למועדפים
2. **מעבר מלא לשרת** לרשימת מועדפים

---

## **🧹 קטגוריה 8: קבצי עזר וכלים (Utilities & Tools)**
### **קבצים למחיקה מלאה:**
- ❌ `services/fallback.js` - מנגנון fallback מקומי
- ❌ `services/migration.js` - מנגנון מיגרציה (לא נדרש יותר)
- ❌ `services/api-with-fallback.js` - API עם fallback
- ❌ `data/storage.js` - אחסון מקומי כללי
- ❌ `data/listingsRepo.js` - repository מקומי
- ❌ `utils/legacy-cleanup.js` - כלי ניקוי
- ❌ `utils/auth-fix.js` - כלי תיקון (יצרנו לדיבוג)
- ❌ `screens/DebugScreen.js` - מסך דיבוג
- ❌ `screens/LegacyCleanupScreen.js` - מסך ניקוי
- ❌ `tests/migration-regression.js` - בדיקות מיגרציה

### **פעולות נדרשות:**
1. **מחיקה מלאה** של כל הקבצים
2. **הסרת imports** מקבצים אחרים
3. **ניקוי references** בניווט ובקוד

---

## **📊 סדר עדיפויות להסרה:**

### **🚨 עדיפות קריטית (לפני הכל):**
1. **קטגוריה 8** - מחיקת קבצי עזר וכלים
2. **יצירת APIs חסרים** - מקומות שמורים, חיפושים, מועדפים

### **⚡ עדיפות גבוהה:**
3. **קטגוריה 6** - חיפוש ומקומות (הכי הרבה שימושים)
4. **קטגוריה 2** - הזמנות (קריטי לפונקציונליות)
5. **קטגוריה 4** - רכבים (קריטי לפונקציונליות)

### **🔄 עדיפות בינונית:**
6. **קטגוריה 3** - פרופיל ונתוני משתמש
7. **קטגוריה 5** - בעלי חניות
8. **קטגוריה 7** - מועדפים

### **✅ עדיפות נמוכה:**
9. **קטגוריה 1** - אימות (כבר תקין, רק לוודא)

---

## **🛡️ מנגנוני Error Handling ללא Fallback:**

### **עקרונות חדשים:**
1. **אין fallback מקומי** - בכלל
2. **מסכי שגיאה ברורים** - במקום שמירה מקומית
3. **retry אוטומטי** - מהשרת בלבד
4. **offline mode** - מסך "אין חיבור" בלבד

### **דפוסי Error Handling חדשים:**
```javascript
// ❌ הישן - עם fallback
try {
  const result = await api.post('/api/bookings', data);
  // שמירה מקומית כגיבוי
  await AsyncStorage.setItem('bookings', JSON.stringify(data));
} catch (error) {
  // fallback לשמירה מקומית
  await AsyncStorage.setItem('bookings', JSON.stringify(data));
}

// ✅ החדש - ללא fallback
try {
  const result = await api.post('/api/bookings', data);
  // הצלחה - ממשיכים
} catch (error) {
  // שגיאה - מסך שגיאה עם retry
  showErrorScreen(error, () => retryBooking(data));
}
```

### **מסכי שגיאה חדשים:**
- **NetworkErrorScreen** - "אין חיבור לשרת"
- **ServerErrorScreen** - "שגיאה בשרת, נסה שוב"
- **AuthErrorScreen** - "נדרשת התחברות מחדש"

---

**✅ Step 1.3 הושלם - תכנית הסרה מתואמת מוכנה**
